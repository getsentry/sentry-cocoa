---
phase: 05-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - develop-docs/SENTRYCRASH.md

must_haves:
  truths:
    - "develop-docs/SENTRYCRASH.md contains a Dependency Isolation section documenting the facade pattern"
    - "Documentation explains why SentryCrash must not directly access SentryDependencyContainer"
    - "Documentation lists all five services provided through SentryCrashBridge"
    - "Documentation provides guidance for adding new SentryCrash dependencies"
  artifacts:
    - path: "develop-docs/SENTRYCRASH.md"
      provides: "Facade pattern documentation for SentryCrash boundary"
      pattern: "SentryCrashBridge"
      expected_matches: 3
  key_links:
    - from: "Documentation"
      to: "SentryCrashBridge implementation"
      via: "Architectural description"
      pattern: "facade"
---

<objective>
Add a Dependency Isolation section to the existing `develop-docs/SENTRYCRASH.md` documenting the SentryCrashBridge facade pattern.

Purpose: Document the architectural boundary between SentryCrash and the SDK so future maintainers understand why SentryCrash must not directly access SentryDependencyContainer and how to add new dependencies through the bridge.
Output: Updated SENTRYCRASH.md with complete facade pattern documentation.
</objective>

<execution_context>
@/Users/itaybrenner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/itaybrenner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/itaybrenner/sentry/sentry-cocoa/.planning/PROJECT.md
@/Users/itaybrenner/sentry/sentry-cocoa/.planning/ROADMAP.md
@/Users/itaybrenner/sentry/sentry-cocoa/.planning/STATE.md
@/Users/itaybrenner/sentry/sentry-cocoa/AGENTS.md

# Key implementation files to reference

@/Users/itaybrenner/sentry/sentry-cocoa/Sources/Swift/Integrations/SentryCrash/SentryCrashBridge.swift
@/Users/itaybrenner/sentry/sentry-cocoa/Sources/Swift/Integrations/SentryCrash/SentryCrashIntegration.swift
@/Users/itaybrenner/sentry/sentry-cocoa/Sources/Swift/SentryCrash/SentryCrashWrapper.swift
@/Users/itaybrenner/sentry/sentry-cocoa/Sources/SentryCrash/Recording/SentryCrash.m
@/Users/itaybrenner/sentry/sentry-cocoa/Sources/SentryCrash/Installations/SentryCrashInstallation.m
@/Users/itaybrenner/sentry/sentry-cocoa/Sources/SentryCrash/Recording/Monitors/SentryCrashMonitor_NSException.m
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Dependency Isolation section to SENTRYCRASH.md</name>
  <files>develop-docs/SENTRYCRASH.md</files>
  <action>
Add a new top-level section titled "Dependency Isolation (SentryCrashBridge)" to `develop-docs/SENTRYCRASH.md`. Insert it **after the "Phase 1: Isolation (Public API)" section** (after line 332's `---` separator) and **before the "Phase 2: Confidence (Test Coverage)" section**.

The section must cover these four areas per DOCS-01 requirements:

**1. Overview of the Facade Pattern**

Explain that `SentryCrashBridge` is a concrete facade class that provides all SDK services SentryCrash needs, decoupling SentryCrash from `SentryDependencyContainer`. The bridge is created by `SentryCrashIntegration` during SDK initialization and injected into SentryCrash components before crash handler installation.

**2. Why SentryCrash Must Not Access SentryDependencyContainer**

Explain:

- SentryCrash is a low-level crash recording subsystem that should be loosely coupled from the SDK's service container
- Direct container access creates bidirectional coupling that makes SentryCrash harder to test, maintain, and potentially extract
- The facade provides a clear dependency boundary: SentryCrash declares what it needs, the SDK provides it
- All SentryCrash dependencies are visible in one place (the bridge class), making the subsystem's requirements explicit

**3. Five Services Provided Through the Bridge**

Document each service with its type and purpose:

| Service                     | Type                                   | Purpose                                                                                                                                 |
| --------------------------- | -------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------- |
| `notificationCenterWrapper` | `SentryNSNotificationCenterWrapper`    | App lifecycle event observation (used by `SentryCrash.m`)                                                                               |
| `dateProvider`              | `SentryCurrentDateProvider`            | Timestamps for session handling (used by `SentryCrashIntegrationSessionHandler`)                                                        |
| `crashReporter`             | `SentryCrashSwift`                     | System info, crash state, report management (used by `SentryCrashWrapper`, `SentryCrashInstallation`, `SentryCrashMonitor_NSException`) |
| `uncaughtExceptionHandler`  | `@convention(c) (NSException) -> Void` | Computed property bridging to crashReporter (used by `SentryCrashMonitor_NSException`)                                                  |
| `activeScreenSize()`        | `CGSize` (iOS/tvOS only)               | Device screen dimensions (used by `SentryCrashWrapper`)                                                                                 |

**4. How to Add New SentryCrash Dependencies**

Provide step-by-step guidance:

1. Add the new service as a property on `SentryCrashBridge` (in `Sources/Swift/Integrations/SentryCrash/SentryCrashBridge.swift`)
2. Pass the service during bridge initialization in `SentryCrashIntegration.init()`
3. Access the service through the bridge in the SentryCrash component that needs it
4. **Never** import or reference `SentryDependencyContainer` from files in `Sources/SentryCrash/` or `Sources/Swift/SentryCrash/`
5. Verify with grep: `grep -r "SentryDependencyContainer" Sources/SentryCrash/ Sources/Swift/SentryCrash/` should return zero results

**5. Bridge Injection Patterns**

Document the three injection patterns used:

- **Swift property injection**: `SentryCrashWrapper` receives bridge through its initializer
- **KVC injection**: `SentryCrashIntegration` injects bridge into ObjC objects via `setValue(_:forKey:)` when the ObjC property type is not visible at Swift compile time
- **Static C function setter**: `SentryCrashMonitor_NSException` uses `sentrycrashcm_nsexception_setBridge()` to set a module-level static variable for access from C-style static functions

**Implementation notes:**

- Read the existing SENTRYCRASH.md file first
- Insert the new section at the specified location
- Match the existing document's markdown formatting style (using `###` for subsections, tables for structured data, code blocks for paths)
- Keep the section concise and focused on the facade pattern
- Do NOT modify any other sections of the document
  </action>
  <verify>
  Read `develop-docs/SENTRYCRASH.md` and confirm:
  1. A section titled "Dependency Isolation (SentryCrashBridge)" exists
  2. It explains why SentryCrash must not access SentryDependencyContainer
  3. It lists all five services in a table
  4. It provides step-by-step guidance for adding new dependencies
  5. It documents the three injection patterns
  6. grep for "SentryCrashBridge" returns at least 3 matches in the file
     </verify>
     <done>
     SENTRYCRASH.md contains a complete Dependency Isolation section covering the facade pattern, rationale, services, and guidance for future maintainers.
     </done>
     </task>

</tasks>

<verification>
Phase 5 verification complete when:

1. **DOCS-01**: `develop-docs/SENTRYCRASH.md` contains a Dependency Isolation section
2. Section explains why SentryCrash must not directly access SentryDependencyContainer
3. Section lists all five services provided through the bridge
4. Section provides clear guidance for adding new SentryCrash dependencies
5. Document compiles cleanly (no broken markdown)
   </verification>

<success_criteria>

1. `develop-docs/SENTRYCRASH.md` has a Dependency Isolation section documenting the SentryCrashBridge facade
2. Documentation explains the architectural boundary rationale
3. All five bridge services are documented with types and purposes
4. Step-by-step guidance exists for adding new dependencies
5. Three injection patterns are documented
   </success_criteria>

<output>
After completion, create `.planning/phases/05-documentation/05-01-SUMMARY.md` documenting:
- What was added to SENTRYCRASH.md
- Confirmation that all DOCS-01 requirements are satisfied
- Line count of added content
</output>
