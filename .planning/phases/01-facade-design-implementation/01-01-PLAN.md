---
phase: 01-facade-design-implementation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Sources/Swift/Integrations/SentryCrash/SentryCrashBridge.swift
autonomous: true

must_haves:
  truths:
    - "SentryCrashBridge class exists and is accessible from both Swift and Objective-C"
    - "Facade exposes all five required services: notificationCenterWrapper, dateProvider, crashReporter, uncaughtExceptionHandler, activeScreenSize"
    - "Facade compiles on all platforms (iOS, macOS, tvOS, watchOS, visionOS)"
  artifacts:
    - path: "Sources/Swift/Integrations/SentryCrash/SentryCrashBridge.swift"
      provides: "Concrete facade class bridging SDK services to SentryCrash"
      min_lines: 40
      contains: "@objc @_spi(Private) public final class SentryCrashBridge"
  key_links:
    - from: "Sources/Swift/Integrations/SentryCrash/SentryCrashBridge.swift"
      to: "SentryNSNotificationCenterWrapper protocol"
      via: "property type"
      pattern: "let notificationCenterWrapper: SentryNSNotificationCenterWrapper"
    - from: "Sources/Swift/Integrations/SentryCrash/SentryCrashBridge.swift"
      to: "SentryCurrentDateProvider"
      via: "property type"
      pattern: "let dateProvider: SentryCurrentDateProvider"
    - from: "Sources/Swift/Integrations/SentryCrash/SentryCrashBridge.swift"
      to: "SentryCrashSwift.crashReporter"
      via: "property type"
      pattern: "let crashReporter: SentryCrashSwift"
---

<objective>
Create the SDK-side concrete facade class (SentryCrashBridge) that provides all five services SentryCrash needs without requiring direct container access.

Purpose: Establish the architectural boundary between SDK and SentryCrash by providing a single bridge class that exposes only the necessary services (notificationCenterWrapper, dateProvider, crashReporter, uncaughtExceptionHandler, activeScreenSize).

Output: SentryCrashBridge.swift file containing a concrete @objc-accessible class with all five service properties, following existing patterns from SentryDependencyContainerSwiftHelper and SentryNSNotificationCenterWrapper.
</objective>

<execution_context>
@/Users/itaybrenner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/itaybrenner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-facade-design-implementation/01-RESEARCH.md

Related existing code patterns:
@Sources/Swift/Helper/SentryNSNotificationCenterWrapper.swift
@Sources/Sentry/SentryDependencyContainerSwiftHelper.h
@Sources/Swift/Integrations/SentryCrash/SentryCrashIntegration.swift
</context>

<tasks>

<task type="auto">
  <name>Create SentryCrashBridge facade class with all five service properties</name>
  <files>Sources/Swift/Integrations/SentryCrash/SentryCrashBridge.swift</files>
  <action>
Create SentryCrashBridge.swift in Sources/Swift/Integrations/SentryCrash/ directory with the following implementation:

1. **File structure**: Follow existing conventions from CONVENTIONS.md
   - Start with @_implementationOnly import _SentryPrivate if needed
   - Import Foundation
   - Add conditional UIKit imports for iOS/tvOS (matching pattern in SentryCrashIntegration.swift lines 4-6)

2. **Class definition**: Create concrete facade inheriting from NSObject
   - Mark as `@objc @_spi(Private) public final class SentryCrashBridge: NSObject`
   - This matches the pattern from SentryNSNotificationCenterWrapper.swift for Swift-to-ObjC bridging

3. **Five service properties** (per RESEARCH.md Pattern 1):
   - `@objc public let notificationCenterWrapper: SentryNSNotificationCenterWrapper` - for app lifecycle events
   - `@objc public let dateProvider: SentryCurrentDateProvider` - for timestamps
   - `@objc public let crashReporter: SentryCrashSwift` - for system info and crash state
   - `@objc public var uncaughtExceptionHandler` - computed property returning `crashReporter.uncaughtExceptionHandler` (lazy bridging pattern per RESEARCH.md Pattern 2)
   - `@objc public func activeScreenSize() -> CGSize` - platform-conditional method (only on iOS/tvOS) that delegates to `SentryDependencyContainerSwiftHelper.activeScreenSize()`

4. **Platform-specific code**: Wrap activeScreenSize in conditional compilation
   - `#if (os(iOS) || os(tvOS)) && !SENTRY_NO_UI_FRAMEWORK`
   - Match pattern from SentryCrashIntegration.swift lines 4-6 and SentryDependencyContainerSwiftHelper.h

5. **Initializer**:
   - `@objc public init(notificationCenterWrapper:, dateProvider:, crashReporter:)` taking three stored properties
   - Call super.init() after assigning properties
   - Do NOT create a singleton or static shared instance (per RESEARCH.md anti-patterns)

6. **Documentation**: Add brief doc comments explaining the facade's purpose
   - "Concrete facade bridging SDK services to SentryCrash without requiring direct SentryDependencyContainer access"
   - Reference existing patterns from SentryNSNotificationCenterWrapper.swift for style

**What to avoid** (per RESEARCH.md pitfalls):

- DO NOT create singleton/shared instance
- DO NOT import SentryCrash files (only SDK services)
- DO NOT use @objc on types that can't bridge (all types here are compatible)
- DO NOT forget NSObject inheritance
- DO NOT expose as public API (use @_spi(Private))
  </action>
  <verify>
  Compilation check:

```bash
cd /Users/itaybrenner/sentry/sentry-cocoa
make build-for-ios
```

Verify file structure:

```bash
cat Sources/Swift/Integrations/SentryCrash/SentryCrashBridge.swift | grep -E "@objc|class SentryCrashBridge|notificationCenterWrapper|dateProvider|crashReporter|uncaughtExceptionHandler|activeScreenSize"
```

Expected: All five services present, class marked @objc, inherits NSObject
</verify>
<done>

- SentryCrashBridge.swift file exists in Sources/Swift/Integrations/SentryCrash/
- File compiles without errors for iOS platform
- Class is marked @objc @_spi(Private) and inherits from NSObject
- All five service properties/methods are present and @objc-accessible
- activeScreenSize() is conditionally compiled for iOS/tvOS only
- No singleton pattern (facade is instantiated, not accessed statically)
  </done>
  </task>

</tasks>

<verification>
1. **Compilation**: `make build-for-ios` completes without errors
2. **Platform support**: File compiles on all target platforms (iOS, macOS, tvOS, watchOS, visionOS)
3. **ObjC accessibility**: Class and properties are marked @objc
4. **Service coverage**: All five required services are exposed (notificationCenterWrapper, dateProvider, crashReporter, uncaughtExceptionHandler, activeScreenSize)
5. **Pattern adherence**: Follows existing codebase patterns from SentryNSNotificationCenterWrapper and SentryDependencyContainerSwiftHelper
</verification>

<success_criteria>

- [ ] SentryCrashBridge.swift exists with concrete class implementation
- [ ] Class inherits from NSObject and is marked @objc @_spi(Private)
- [ ] All five service properties/methods are present and @objc-accessible
- [ ] File compiles on iOS without errors
- [ ] activeScreenSize() is platform-conditional (iOS/tvOS only)
- [ ] No singleton pattern used
- [ ] Follows existing codebase conventions for Swift/ObjC bridging
      </success_criteria>

<output>
After completion, create `.planning/phases/01-facade-design-implementation/01-01-SUMMARY.md`
</output>
