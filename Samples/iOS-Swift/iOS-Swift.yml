# yaml-language-server: $schema=../../schema/xcodegen.schema.json

name: iOS-Swift
include:
  - ../Shared/feature-flags.yml
createIntermediateGroups: true
generateEmptyDirectories: true
configs:
  Debug: debug
  Test: debug
  TestCI: debug
  Release: release
projectReferences:
  Sentry:
    path: ../../Sentry.xcodeproj
  SentrySampleShared:
    path: ../SentrySampleShared/SentrySampleShared.xcodeproj
fileGroups:
  - ../Shared/Config
  - ShareExtension/Configuration
  - ActionExtension/Configuration
  - IntentExtension/Configuration
  - iOS-Swift.yml
  - ../../Plans/iOS-Swift_Base.xctestplan
  - ../../Plans/iOS-Benchmarking_Base.xctestplan
options:
  bundleIdPrefix: io.sentry
  defaultSourceDirectoryType: syncedFolder
targets:
  App:
    type: application
    platform: auto
    sources:
      - path: App
        type: group
        excludes:
          - "**/Info.plist"
      - ../Shared/SampleAssets.xcassets
    dependencies:
      - target: Sentry/Sentry
      - target: AppClip
      - target: SentrySampleShared/SentrySampleShared
      - target: ShareExtension
      - target: ActionExtension
      - target: IntentExtension
    configFiles:
      Debug: App/Configuration/iOS-Swift.xcconfig
      Release: App/Configuration/iOS-Swift.xcconfig
      Test: App/Configuration/iOS-Swift.xcconfig
      TestCI: App/Configuration/iOS-Swift.xcconfig
    postCompileScripts:
      - script: ../Shared/inject-git-info.sh
        name: Inject Git Information into Info.plist
        basedOnDependencyAnalysis: false
    postBuildScripts:
      - script: ../Shared/reset-git-info.sh
        name: Reset Git Fields in Info.plist
        basedOnDependencyAnalysis: false
  AppClip:
    type: application.on-demand-install-capable
    platform: auto
    sources:
      - path: AppClip
        type: group
        excludes:
          - "**/Info.plist"
      - ../Shared/SampleAssets.xcassets
    dependencies:
      - target: Sentry/Sentry
      - target: SentrySampleShared/SentrySampleShared
    configFiles:
      Debug: AppClip/Configuration/iOS-SwiftClip.xcconfig
      Release: AppClip/Configuration/iOS-SwiftClip.xcconfig
      Test: AppClip/Configuration/iOS-SwiftClip.xcconfig
      TestCI: AppClip/Configuration/iOS-SwiftClip.xcconfig
    postCompileScripts:
      - script: ../Shared/inject-git-info.sh
        name: Inject Git Information into Info.plist
        basedOnDependencyAnalysis: false
    postBuildScripts:
      - script: ../Shared/reset-git-info.sh
        name: Reset Git Fields in Info.plist
        basedOnDependencyAnalysis: false
  UITests:
    type: bundle.ui-testing
    platform: auto
    sources:
      - path: UITests
        type: group
        excludes:
          - "**/Info.plist"
    dependencies:
      - target: SentrySampleShared/SentrySampleUITestShared
      - target: SentrySampleShared/SentrySampleShared
    configFiles:
      Debug: UITests/Configuration/iOS-Swift-UITests.xcconfig
      Release: UITests/Configuration/iOS-Swift-UITests.xcconfig
      Test: UITests/Configuration/iOS-Swift-UITests.xcconfig
      TestCI: UITests/Configuration/iOS-Swift-UITests.xcconfig
  Benchmarking:
    type: bundle.ui-testing
    platform: auto
    sources:
      - path: Benchmarking
        type: group
        excludes:
          - "**/Info.plist"
      - ../Shared/SampleAssets.xcassets
    dependencies:
      - target: SentrySampleShared/SentrySampleUITestShared
    configFiles:
      Debug: Benchmarking/Configuration/iOS-Benchmarking.xcconfig
      Release: Benchmarking/Configuration/iOS-Benchmarking.xcconfig
      Test: Benchmarking/Configuration/iOS-Benchmarking.xcconfig
      TestCI: Benchmarking/Configuration/iOS-Benchmarking.xcconfig
  ShareExtension:
    type: app-extension
    platform: auto
    sources:
      - ShareExtension/Sources
      - ShareExtension/Resources
    dependencies:
      - target: Sentry/Sentry
      - target: SentrySampleShared/SentrySampleShared
    configFiles:
      Debug: ShareExtension/Configuration/iOS-Swift-ShareExtension.xcconfig
      Release: ShareExtension/Configuration/iOS-Swift-ShareExtension.xcconfig
      Test: ShareExtension/Configuration/iOS-Swift-ShareExtension.xcconfig
      TestCI: ShareExtension/Configuration/iOS-Swift-ShareExtension.xcconfig
  ActionExtension:
    type: app-extension
    platform: auto
    sources:
      - ActionExtension/Sources
      - ActionExtension/Resources
    dependencies:
      - target: Sentry/Sentry
      - target: SentrySampleShared/SentrySampleShared
    configFiles:
      Debug: ActionExtension/Configuration/iOS-Swift-ActionExtension.xcconfig
      Release: ActionExtension/Configuration/iOS-Swift-ActionExtension.xcconfig
      Test: ActionExtension/Configuration/iOS-Swift-ActionExtension.xcconfig
      TestCI: ActionExtension/Configuration/iOS-Swift-ActionExtension.xcconfig
  IntentExtension:
    type: app-extension
    platform: auto
    sources:
      - IntentExtension/Sources
      - IntentExtension/Resources
    dependencies:
      - target: Sentry/Sentry
      - target: SentrySampleShared/SentrySampleShared
    configFiles:
      Debug: IntentExtension/Configuration/iOS-Swift-IntentExtension.xcconfig
      Release: IntentExtension/Configuration/iOS-Swift-IntentExtension.xcconfig
      Test: IntentExtension/Configuration/iOS-Swift-IntentExtension.xcconfig
      TestCI: IntentExtension/Configuration/iOS-Swift-IntentExtension.xcconfig
schemes:
  iOS-Swift:
    templates:
      - SampleAppScheme
    build:
      targets:
        App: all
    test:
      config: Test
      testPlans:
        - path: ../../Plans/iOS-Swift_Base.xctestplan
  iOS-Benchmarking:
    build:
      targets:
        App: test
        Benchmarking: test
    test:
      config: Debug
      testPlans:
        - path: ../../Plans/iOS-Benchmarking_Base.xctestplan
  iOS-Swift-IntentExtension:
    build:
      targets:
        App: all
        IntentExtension: all
    run:
      config: Debug
  iOS-Swift-ActionExtension:
    build:
      targets:
        App: all
        ActionExtension: all
    run:
      config: Debug
  iOS-Swift-ShareExtension:
    build:
      targets:
        App: all
        ShareExtension: all
    run:
      config: Debug
