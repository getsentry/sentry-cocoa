name: release
on:
  workflow_run:
      workflows: ["validate-libs"]
      branches: [ci/**]
      types: 
      - completed
      - requested

jobs:
  job_release:
    name: Building Carthage
    runs-on: ubuntu-latest
    steps:
      - name: Download Sentry.Framework.zip
        uses: actions/download-artifact@v2
        with:
          name: Sentry.Framework.zip
    
      - uses: actions/setup-node@v1
     
      - name: Install Zeus
        run: |
          yarn global add @zeus-ci/cli
          echo "::add-path::$(yarn global bin)"
      - name: Upload to Zeus
        env:
          ZEUS_API_TOKEN: ${{ secrets.ZEUS_API_TOKEN }}
          ZEUS_HOOK_BASE: ${{ secrets.ZEUS_HOOK_BASE }}
        run: |
          zeus job update -b $GITHUB_RUN_ID -j $GITHUB_RUN_NUMBER -r $GITHUB_SHA
          zeus upload -b $GITHUB_RUN_ID -j $GITHUB_RUN_NUMBER -t "application/zip+carthage" Sentry.framework.zip
          zeus job update --status=passed -b $GITHUB_RUN_ID -j $GITHUB_RUN_NUMBER -r $GITHUB_SHA
