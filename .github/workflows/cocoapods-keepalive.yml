name: "CocoaPods Token Keep-Alive"

on:
  schedule:
    # CocoaPods sessions currently expire after 3 days of inactivity (VALIDITY_LENGTH)
    # This runs every day at midnight UTC to keep the current token alive
    # See: https://github.com/CocoaPods/trunk.cocoapods.org/blob/a1869790e9ae2229b6985b6af4532da814202558/app/models/session.rb#L9
    - cron: "0 0 * * *" # Runs every day at midnight UTC
  workflow_dispatch:

permissions:
  contents: read

jobs:
  keepalive:
    name: Refresh CocoaPods Session
    runs-on: macos-15
    env:
      COCOAPODS_TRUNK_TOKEN: ${{ secrets.COCOAPODS_TRUNK_TOKEN }}

    steps:
      - name: Install CocoaPods
        run: gem install cocoapods
      - name: Refresh CocoaPods Session
        run: pod trunk me > /dev/null 2>&1
